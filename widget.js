!function(){"use strict";if(console.log("[RAG Widget] Initializing..."),!window.RAG_CHAT_WIDGET_ID)return console.error("[RAG Widget] Error: RAG_CHAT_WIDGET_ID is not defined"),void console.error("[RAG Widget] Please set window.RAG_CHAT_WIDGET_ID before loading this script");const e=window.RAG_CHAT_WIDGET_ID;if(console.log("[RAG Widget] Widget ID:",e),document.getElementById("rag-chat-widget-root"))return void console.warn("[RAG Widget] Widget already initialized");const t=document.createElement("div");t.id="rag-chat-widget-root",document.body.appendChild(t),t.innerHTML='\n    <div id="rag-chat-widget" style="position: fixed; bottom: 20px; right: 20px; z-index: 999999; font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;">\n      <div id="rag-chat-window" style="display: none; width: 380px; height: 600px; background: white; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); overflow: hidden; flex-direction: column; margin-bottom: 16px;">\n        <div style="background: #0f172a; color: white; padding: 16px; display: flex; align-items: center; justify-content: space-between;">\n          <div style="display: flex; align-items: center; gap: 8px;">\n            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>\n            </svg>\n            <span style="font-weight: 600; font-size: 14px;">Chat Support</span>\n          </div>\n          <button id="rag-close-btn" style="background: none; border: none; color: white; cursor: pointer; padding: 4px; border-radius: 4px;" aria-label="Close">\n            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n              <line x1="18" y1="6" x2="6" y2="18"></line>\n              <line x1="6" y1="6" x2="18" y2="18"></line>\n            </svg>\n          </button>\n        </div>\n        <div id="rag-messages" style="flex: 1; overflow-y: auto; padding: 16px; background: #f9fafb;"></div>\n        <div style="padding: 16px; border-top: 1px solid #e5e7eb; background: white;">\n          <div style="display: flex; gap: 8px;">\n            <input id="rag-input" type="text" placeholder="Type your message..." style="flex: 1; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px;" />\n            <button id="rag-send-btn" style="background: #0f172a; color: white; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500;">Send</button>\n          </div>\n        </div>\n      </div>\n      <button id="rag-toggle-btn" style="width: 60px; height: 60px; border-radius: 50%; background: #0f172a; color: white; border: none; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.15); display: flex; align-items: center; justify-content: center;" aria-label="Toggle chat">\n        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>\n        </svg>\n      </button>\n    </div>\n  ';const n=document.getElementById("rag-chat-window"),o=document.getElementById("rag-toggle-btn"),i=document.getElementById("rag-close-btn"),r=document.getElementById("rag-input"),d=document.getElementById("rag-send-btn"),s=document.getElementById("rag-messages");if(!(n&&o&&i&&r&&d&&s))return void console.error("[RAG Widget] Failed to initialize: required elements not found");let a=!1,l="conv-"+Date.now()+"-"+Math.random().toString(36).substring(7);function c(){a=!a,n.style.display=a?"flex":"none",a&&r&&(r.focus(),0===s.children.length&&g("Hello! How can I help you today?",!1))}function g(e,t){const n=document.createElement("div");n.style.cssText="max-width: 70%; padding: 10px 14px; border-radius: 12px; font-size: 14px; line-height: 1.4; margin: 8px "+(t?"0 0 auto":"auto 0 0")+"; "+(t?"background: #0f172a; color: white;":"background: white; border: 1px solid #e5e7eb; color: #1f2937;"),n.textContent=e,s.appendChild(n),s.scrollTop=s.scrollHeight}function p(){const e=document.getElementById("rag-loading-message");e&&e.remove()}async function u(){const t=r.value.trim();if(t){g(t,!0),r.value="",r.disabled=!0,d.disabled=!0,function(){const e=document.createElement("div");e.id="rag-loading-message",e.style.cssText="max-width: 70%; padding: 10px 14px; border-radius: 12px; font-size: 14px; line-height: 1.4; margin: 8px auto 0 0; background: white; border: 1px solid #e5e7eb; color: #6b7280;",e.textContent="Typing...",s.appendChild(e),s.scrollTop=s.scrollHeight}();try{console.log("[RAG Widget] Sending message to chat endpoint...");const n=await fetch("https://ggcuobyzxnmgywvqywnj.supabase.co/functions/v1/make-server-c52f905e/chat",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdnY3VvYnl6eG5tZ3l3dnF5d25qIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgyOTIzNzksImV4cCI6MjA4Mzg2ODM3OX0.5oB6JBH8g45jk5uFQefZNfr4udLsTSa2KHRM3WpcPZo"},body:JSON.stringify({message:t,widgetId:e,conversationId:l})});if(p(),!n.ok){const e=await n.text().catch(()=>"Unknown error");return console.error("[RAG Widget] Chat API error:",n.status,e),void g("Sorry, I encountered an error. Please try again.",!1)}const o=await n.json();console.log("[RAG Widget] Received response:",o),g(o.message||"Sorry, I could not process your request.",!1),o.conversationId&&(l=o.conversationId)}catch(e){p(),console.error("[RAG Widget] Network error:",e),g("Error: Could not connect to server. Please check your connection.",!1)}finally{r.disabled=!1,d.disabled=!1,r.focus()}}}o.addEventListener("click",c),i.addEventListener("click",c),d.addEventListener("click",u),r.addEventListener("keypress",e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),u())}),console.log("[RAG Widget] Initialized successfully")}();